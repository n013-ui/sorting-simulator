<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ’åºæ¨¡æ“¬å™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0f172a; --card: #1e293b; --card2: #273449;
  --accent: #38bdf8; --accent2: #f472b6; --gold: #fbbf24;
  --green: #4ade80; --red: #f87171; --text: #e2e8f0;
  --muted: #94a3b8; --border: #334155;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 16px; }
h1 { text-align: center; font-size: 2rem; font-weight: 900; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 4px; }
.subtitle { text-align: center; color: var(--muted); font-size: 0.9rem; margin-bottom: 16px; }

.instructions { background: var(--card); border: 2px solid var(--accent); border-radius: 14px; padding: 16px 20px; margin-bottom: 16px; }
.instructions .ititle { font-weight: 900; color: var(--accent); margin-bottom: 10px; font-size: 1rem; }
.instructions ol { padding-left: 20px; }
.instructions li { line-height: 2.2; font-size: 0.92rem; }
.instructions li b { color: var(--gold); }
.instructions .note { margin-top: 10px; padding: 8px 12px; background: var(--card2); border-radius: 8px; font-size: 0.85rem; color: var(--muted); }

.controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 16px; background: var(--card); padding: 12px; border-radius: 14px; border: 1px solid var(--border); }
.ctrl-group { display: flex; align-items: center; gap: 8px; }
.ctrl-group label { font-size: 0.85rem; color: var(--muted); font-weight: 700; }
select { background: var(--card2); border: 1px solid var(--border); color: var(--text); border-radius: 8px; padding: 6px 10px; font-family: 'Nunito', sans-serif; font-size: 0.9rem; cursor: pointer; }
.btn { padding: 8px 18px; border-radius: 10px; border: none; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.9rem; cursor: pointer; transition: all 0.15s; }
.btn:hover { transform: translateY(-2px); filter: brightness(1.15); }
.btn:active { transform: translateY(0); }
.btn-primary { background: var(--accent); color: #0f172a; }
.btn-danger { background: var(--red); color: #0f172a; }
.btn-success { background: var(--green); color: #0f172a; }
.btn-muted { background: var(--card2); color: var(--muted); border: 1px solid var(--border); }
.btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none !important; filter: none !important; }

.stats { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 16px; }
.stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px 20px; text-align: center; min-width: 100px; }
.stat-card .val { font-size: 1.8rem; font-weight: 900; line-height: 1; }
.stat-card .lbl { font-size: 0.75rem; color: var(--muted); font-weight: 700; margin-top: 2px; }
.val-compare { color: var(--accent); }
.val-swap { color: var(--accent2); }
.val-time { color: var(--gold); }

.message-box { background: var(--card2); border-left: 4px solid var(--accent); border-radius: 10px; padding: 10px 14px; font-size: 0.9rem; font-weight: 700; min-height: 44px; display: flex; align-items: center; margin-bottom: 16px; }

.scale-section { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
.section-title { font-size: 0.8rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 16px; text-align: center; }

.pans-layout { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }

.pan-zone { width: 120px; min-height: 120px; border: 3px dashed var(--border); border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.pan-zone.over { border-color: var(--accent); background: rgba(56,189,248,0.1); }
.pan-zone.filled-left { border-style: solid; border-color: var(--accent); }
.pan-zone.filled-right { border-style: solid; border-color: var(--accent2); }
.pan-empty-hint { font-size: 0.75rem; color: var(--border); text-align: center; line-height: 1.6; }
.pan-ball { width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.5rem; color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
.pan-pos { font-size: 0.72rem; color: var(--muted); font-weight: 700; }

.scale-visual { display: flex; flex-direction: column; align-items: center; gap: 4px; flex-shrink: 0; }
.scale-container { width: 90px; height: 80px; position: relative; }
.scale-pole { position: absolute; left: 50%; top: 0; transform: translateX(-50%); width: 5px; height: 44px; background: #64748b; border-radius: 3px; }
.scale-beam { position: absolute; top: 40px; left: 50%; transform: translateX(-50%) rotate(0deg); width: 76px; height: 6px; background: #64748b; border-radius: 3px; transition: transform 0.5s cubic-bezier(.34,1.56,.64,1); transform-origin: center center; }
.scale-tick { position: absolute; top: 6px; width: 2px; height: 12px; background: #64748b; border-radius: 1px; }
.scale-tick.left { left: 3px; }
.scale-tick.right { right: 3px; }
.scale-result-text { font-size: 0.85rem; font-weight: 700; text-align: center; min-height: 22px; padding: 2px 6px; }

.scale-actions { display: flex; gap: 10px; justify-content: center; }

.array-section { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
.array-hint { font-size: 0.82rem; color: var(--muted); margin-bottom: 14px; }
.balls-row { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
.ball-item { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.ball { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.3rem; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.4); cursor: grab; transition: all 0.2s; user-select: none; outline-offset: 4px; }
.ball:hover { transform: scale(1.12); filter: brightness(1.2); }
.ball:active { cursor: grabbing; }
.ball.dragging { opacity: 0.35; transform: scale(0.95); }
.ball.on-left { outline: 3px solid var(--accent); }
.ball.on-right { outline: 3px solid var(--accent2); }
.ball.sorted { outline: 3px solid var(--green); opacity: 0.8; cursor: default; }
.ball-idx { font-size: 0.68rem; color: var(--muted); font-weight: 700; }

.target-section { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 12px 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.target-lbl { font-size: 0.8rem; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em; }

.log-section { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; margin-bottom: 16px; }
.log-title { font-size: 0.8rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 10px; display: flex; justify-content: space-between; }
.log-list { max-height: 160px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; }
.log-entry { font-size: 0.82rem; padding: 6px 10px; border-radius: 8px; background: var(--card2); display: flex; align-items: center; gap: 8px; }
.tag { font-size: 0.7rem; font-weight: 800; padding: 2px 7px; border-radius: 5px; flex-shrink: 0; }
.tag-compare { background: #0ea5e9; color: #0f172a; }
.tag-swap { background: var(--accent2); color: #0f172a; }
.tag-done { background: var(--green); color: #0f172a; }

.history-section { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
th { text-align: left; padding: 6px 10px; color: var(--muted); font-weight: 700; border-bottom: 1px solid var(--border); font-size: 0.75rem; text-transform: uppercase; }
td { padding: 6px 10px; border-bottom: 1px solid var(--border); }
tr:last-child td { border-bottom: none; }

.win-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 99; }
.win-banner { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: var(--card); border: 2px solid var(--green); border-radius: 20px; padding: 32px 40px; text-align: center; z-index: 100; box-shadow: 0 20px 60px rgba(0,0,0,0.8); min-width: 280px; }
.win-banner h2 { font-size: 2rem; color: var(--green); -webkit-text-fill-color: var(--green); margin-bottom: 10px; }
.win-stats { color: var(--muted); font-size: 0.95rem; line-height: 2.2; margin-bottom: 20px; }

@media (max-width: 480px) {
  h1 { font-size: 1.5rem; }
  .ball { width: 46px; height: 46px; font-size: 1.1rem; }
  .pan-zone { width: 100px; }
}
</style>
</head>
<body>

<h1>âš–ï¸ æ’åºæ¨¡æ“¬å™¨</h1>
<p class="subtitle">è‡ªç”±ç·´ç¿’æ’åº â€” ç”¨ä»»ä½•æ–¹å¼æŠŠçƒå¾å°æ’åˆ°å¤§ï¼</p>

<div class="instructions">
  <div class="ititle">ğŸ“‹ æ“ä½œèªªæ˜</div>
  <ol>
    <li><b>ç¬¬ä¸€æ­¥</b>ï¼šå¾ä¸‹æ–¹ã€Œç›®å‰æ’åˆ—ã€ï¼Œç”¨æ»‘é¼ æŠŠä¸€é¡†çƒ <b>æ‹–æ›³</b> åˆ°å¤©å¹³çš„ <b>å·¦æ‰˜ç›¤</b></li>
    <li><b>ç¬¬äºŒæ­¥</b>ï¼šå†æŠŠå¦ä¸€é¡†çƒæ‹–æ›³åˆ°å¤©å¹³çš„ <b>å³æ‰˜ç›¤</b></li>
    <li><b>ç¬¬ä¸‰æ­¥</b>ï¼šå¤©å¹³æœƒå‚¾æ–œ â€”â€” <b>è¼ƒä½çš„é‚£å´</b> ä»£è¡¨æ•¸å­—è¼ƒå¤§</li>
    <li><b>ç¬¬å››æ­¥</b>ï¼šè‹¥éœ€è¦äº¤æ›ï¼Œé» <b>ã€ŒğŸ”„ äº¤æ›ã€</b>ï¼›ä¸äº¤æ›å°±ç¹¼çºŒæ‹–ä¸‹ä¸€é¡†çƒ</li>
    <li><b>ç›®æ¨™</b>ï¼šè®“æ‰€æœ‰çƒå¾å·¦åˆ°å³ç”±å°æ’åˆ°å¤§ï¼Œå®Œæˆæ’åºå³å‹åˆ©ï¼ğŸ‰</li>
  </ol>
  <div class="note">ğŸ’¡ å¯ä»¥ç”¨ä»»ä½•æ’åºæ–¹æ³•ï¼Œç³»çµ±æœƒè¨˜éŒ„ä½ çš„æ¯”è¼ƒæ¬¡æ•¸èˆ‡äº¤æ›æ¬¡æ•¸ã€‚</div>
</div>

<div class="controls">
  <div class="ctrl-group">
    <label>çƒæ•¸ï¼š</label>
    <select id="ballCount">
      <option value="4">4 é¡†</option>
      <option value="5" selected>5 é¡†</option>
      <option value="6">6 é¡†</option>
      <option value="7">7 é¡†</option>
      <option value="8">8 é¡†</option>
    </select>
  </div>
  <button class="btn btn-primary" onclick="initGame()">ğŸ”€ é‡æ–°ç”¢ç”Ÿ</button>
</div>

<div class="stats">
  <div class="stat-card">
    <div class="val val-compare" id="statCompare">0</div>
    <div class="lbl">âš–ï¸ æ¯”è¼ƒæ¬¡æ•¸</div>
  </div>
  <div class="stat-card">
    <div class="val val-swap" id="statSwap">0</div>
    <div class="lbl">ğŸ”„ äº¤æ›æ¬¡æ•¸</div>
  </div>
  <div class="stat-card">
    <div class="val val-time" id="statTime">00:00</div>
    <div class="lbl">â±ï¸ ç”¨æ™‚</div>
  </div>
</div>

<div class="message-box" id="msgBox">æŠŠçƒæ‹–æ›³åˆ°å¤©å¹³çš„å·¦å³æ‰˜ç›¤ä¾†é–‹å§‹æ¯”è¼ƒï¼</div>

<div class="scale-section">
  <div class="section-title">âš–ï¸ å¤©å¹³æ¯”è¼ƒå€ â€” å°‡çƒæ‹–æ›³è‡³å·¦æ‰˜ç›¤æˆ–å³æ‰˜ç›¤</div>
  <div class="pans-layout">

    <div style="display:flex;flex-direction:column;align-items:center;gap:6px">
      <div style="font-size:0.8rem;font-weight:800;color:var(--accent)">â† å·¦æ‰˜ç›¤</div>
      <div class="pan-zone" id="panLeft"
           ondragover="onDragOverPan(event,'left')"
           ondragleave="onDragLeavePan(event,'left')"
           ondrop="onDropPan(event,'left')">
        <div id="panLeftContent"><span class="pan-empty-hint">å°‡çƒæ‹–æ›³<br>è‡³æ­¤</span></div>
      </div>
    </div>

    <div class="scale-visual">
      <div class="scale-container">
        <div class="scale-pole"></div>
        <div class="scale-beam" id="scaleBeam">
          <div class="scale-tick left"></div>
          <div class="scale-tick right"></div>
        </div>
      </div>
      <div class="scale-result-text" id="scaleResult">â€”</div>
    </div>

    <div style="display:flex;flex-direction:column;align-items:center;gap:6px">
      <div style="font-size:0.8rem;font-weight:800;color:var(--accent2)">å³æ‰˜ç›¤ â†’</div>
      <div class="pan-zone" id="panRight"
           ondragover="onDragOverPan(event,'right')"
           ondragleave="onDragLeavePan(event,'right')"
           ondrop="onDropPan(event,'right')">
        <div id="panRightContent"><span class="pan-empty-hint">å°‡çƒæ‹–æ›³<br>è‡³æ­¤</span></div>
      </div>
    </div>

  </div>
  <div class="scale-actions">
    <button class="btn btn-muted" id="clearBtn" onclick="clearPans()" disabled>âœ• æ¸…é™¤æ‰˜ç›¤</button>
    <button class="btn btn-success" id="swapBtn" onclick="doSwap()" disabled>ğŸ”„ äº¤æ›å…©çƒä½ç½®</button>
  </div>
</div>

<div class="array-section">
  <div class="section-title" style="text-align:left;margin-bottom:6px">ğŸ± ç›®å‰æ’åˆ—</div>
  <div class="array-hint">â†“ ç”¨æ»‘é¼ å°‡çƒæ‹–æ›³åˆ°ä¸Šæ–¹å¤©å¹³çš„å·¦æ‰˜ç›¤æˆ–å³æ‰˜ç›¤</div>
  <div class="balls-row" id="ballsRow"></div>
</div>

<div class="target-section">
  <span class="target-lbl">ğŸ¯ ç›®æ¨™ï¼ˆç”±å°åˆ°å¤§ï¼‰ï¼š</span>
  <span id="targetDisplay" style="font-weight:800;font-size:1rem;letter-spacing:3px;color:var(--green)"></span>
</div>

<div class="log-section">
  <div class="log-title">
    <span>ğŸ“‹ æ“ä½œç´€éŒ„</span>
    <span id="logCount" style="font-weight:400">0 ç­†</span>
  </div>
  <div class="log-list" id="logList"></div>
</div>

<div class="history-section">
  <div class="log-title">
    <span>ğŸ† æ­·å²ç´€éŒ„</span>
    <button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem" onclick="clearHistory()">æ¸…é™¤</button>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>çƒæ•¸</th><th>æ¯”è¼ƒæ¬¡æ•¸</th><th>äº¤æ›æ¬¡æ•¸</th><th>ç”¨æ™‚</th><th>æ™‚é–“</th></tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>
</div>

<div class="win-overlay" id="winOverlay" onclick="closeWin()"></div>
<div class="win-banner" id="winBanner">
  <h2>ğŸ‰ æ’åºå®Œæˆï¼</h2>
  <div class="win-stats" id="winStats"></div>
  <button class="btn btn-primary" onclick="closeWin(); initGame()">ğŸ”€ å†ç©ä¸€æ¬¡</button>
</div>

<script>
const COLORS = ['#f43f5e','#f97316','#eab308','#22c55e','#06b6d4','#6366f1','#a855f7','#ec4899'];
let arr = [], panL = null, panR = null;
let compareCount = 0, swapCount = 0;
let startTime = null, timerInterval = null, gameDone = false;
let history = JSON.parse(localStorage.getItem('sortHistoryFree') || '[]');

function startTimer() {
  startTime = Date.now();
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    const e = Math.floor((Date.now() - startTime) / 1000);
    document.getElementById('statTime').textContent =
      String(Math.floor(e/60)).padStart(2,'0') + ':' + String(e%60).padStart(2,'0');
  }, 500);
}
function stopTimer() { if (timerInterval) { clearInterval(timerInterval); timerInterval = null; } }
function elapsedStr() {
  if (!startTime) return '00:00';
  const e = Math.floor((Date.now() - startTime) / 1000);
  return String(Math.floor(e/60)).padStart(2,'0') + ':' + String(e%60).padStart(2,'0');
}

function shuffle(a) {
  for (let i = a.length-1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}
function isSorted() { for (let i=0;i<arr.length-1;i++) if (arr[i]>arr[i+1]) return false; return true; }

function initGame() {
  stopTimer();
  const n = parseInt(document.getElementById('ballCount').value);
  arr = shuffle([...Array(n)].map((_,i)=>i+1));
  while (isSorted()) arr = shuffle([...arr]);
  compareCount = 0; swapCount = 0; gameDone = false; panL = null; panR = null;
  clearLog(); updateStats(); renderBalls(); resetScale();
  setMsg('æŠŠçƒæ‹–æ›³åˆ°å¤©å¹³çš„å·¦å³æ‰˜ç›¤ä¾†é–‹å§‹æ¯”è¼ƒï¼');
  document.getElementById('targetDisplay').textContent = Array.from({length:n},(_,i)=>i+1).join(' ï¼œ ');
  document.getElementById('winBanner').style.display = 'none';
  document.getElementById('winOverlay').style.display = 'none';
  startTimer();
}

function renderBalls() {
  const row = document.getElementById('ballsRow');
  row.innerHTML = '';
  arr.forEach((val, idx) => {
    const item = document.createElement('div'); item.className = 'ball-item';
    const ball = document.createElement('div'); ball.className = 'ball';
    ball.style.background = COLORS[(val-1)%COLORS.length]; ball.textContent = val;
    if (!gameDone) {
      ball.draggable = true; ball.dataset.index = idx;
      ball.addEventListener('dragstart', e => onDragStart(e, idx));
      ball.addEventListener('dragend', onDragEnd);
      if (panL && panL.index === idx) ball.classList.add('on-left');
      if (panR && panR.index === idx) ball.classList.add('on-right');
    } else { ball.classList.add('sorted'); }
    const lbl = document.createElement('div'); lbl.className = 'ball-idx';
    lbl.textContent = 'ä½ç½® '+(idx+1);
    item.appendChild(ball); item.appendChild(lbl); row.appendChild(item);
  });
}

function onDragStart(e, index) {
  e.dataTransfer.setData('text/plain', String(index)); e.dataTransfer.effectAllowed = 'copy';
  setTimeout(() => { document.querySelectorAll('.ball').forEach(b => { if (parseInt(b.dataset.index)===index) b.classList.add('dragging'); }); }, 0);
}
function onDragEnd() { document.querySelectorAll('.ball').forEach(b => b.classList.remove('dragging')); }
function onDragOverPan(e, side) { e.preventDefault(); e.dataTransfer.dropEffect='copy'; document.getElementById(side==='left'?'panLeft':'panRight').classList.add('over'); }
function onDragLeavePan(e, side) { document.getElementById(side==='left'?'panLeft':'panRight').classList.remove('over'); }

function onDropPan(e, side) {
  e.preventDefault();
  document.getElementById(side==='left'?'panLeft':'panRight').classList.remove('over');
  const index = parseInt(e.dataTransfer.getData('text/plain'));
  if (isNaN(index)||index<0||index>=arr.length) return;
  const value = arr[index];
  if (side==='left'  && panR && panR.index===index) { setMsg('âš ï¸ é€™é¡†çƒå·²åœ¨å³æ‰˜ç›¤ï¼è«‹é¸å¦ä¸€é¡†ã€‚'); return; }
  if (side==='right' && panL && panL.index===index) { setMsg('âš ï¸ é€™é¡†çƒå·²åœ¨å·¦æ‰˜ç›¤ï¼è«‹é¸å¦ä¸€é¡†ã€‚'); return; }
  if (side==='left') panL={index,value}; else panR={index,value};
  renderPan('left', panL); renderPan('right', panR); renderBalls();
  document.getElementById('clearBtn').disabled = false;
  if (panL && panR) { compareCount++; updateStats(); updateScale(); addLog('compare',`æ¯”è¼ƒ ä½ç½®${panL.index+1}ï¼ˆçƒ ${panL.value}ï¼‰å’Œ ä½ç½®${panR.index+1}ï¼ˆçƒ ${panR.value}ï¼‰`); document.getElementById('swapBtn').disabled=false; }
}

function renderPan(side, state) {
  const panEl  = document.getElementById(side==='left'?'panLeft':'panRight');
  const contEl = document.getElementById(side==='left'?'panLeftContent':'panRightContent');
  panEl.classList.remove('filled-left','filled-right');
  if (state) {
    panEl.classList.add(side==='left'?'filled-left':'filled-right');
    const ball = document.createElement('div'); ball.className='pan-ball';
    ball.style.background=COLORS[(state.value-1)%COLORS.length]; ball.textContent=state.value;
    const pos = document.createElement('div'); pos.className='pan-pos'; pos.textContent='ä½ç½® '+(state.index+1);
    contEl.innerHTML=''; contEl.appendChild(ball); contEl.appendChild(pos);
  } else { contEl.innerHTML='<span class="pan-empty-hint">å°‡çƒæ‹–æ›³<br>è‡³æ­¤</span>'; }
}

function updateScale() {
  if (!panL||!panR) return;
  const l=panL.value, r=panR.value;
  const beam=document.getElementById('scaleBeam'), res=document.getElementById('scaleResult');
  if (l>r) {
    beam.style.transform='translateX(-50%) rotate(-15deg)';
    res.innerHTML=`<span style="color:var(--accent2)">å·¦é‚Š ${l} ï¼ å³é‚Š ${r}ï¼Œå·¦å´è¼ƒé‡ â†™</span>`;
    setMsg(`âš–ï¸ çƒ ${l}ï¼ˆä½ç½®${panL.index+1}ï¼‰å¤§æ–¼ çƒ ${r}ï¼ˆä½ç½®${panR.index+1}ï¼‰â€” éœ€è¦äº¤æ›å—ï¼Ÿ`);
  } else if (l<r) {
    beam.style.transform='translateX(-50%) rotate(15deg)';
    res.innerHTML=`<span style="color:var(--green)">å·¦é‚Š ${l} ï¼œ å³é‚Š ${r}ï¼Œå³å´è¼ƒé‡ â†˜</span>`;
    setMsg(`âš–ï¸ çƒ ${l}ï¼ˆä½ç½®${panL.index+1}ï¼‰å°æ–¼ çƒ ${r}ï¼ˆä½ç½®${panR.index+1}ï¼‰â€” é †åºæ­£ç¢ºï¼Œä¸éœ€äº¤æ›ï¼`);
  } else {
    beam.style.transform='translateX(-50%) rotate(0deg)';
    res.innerHTML=`<span style="color:var(--muted)">å…©çƒç›¸ç­‰ï¼Œå¤©å¹³å¹³è¡¡</span>`;
    setMsg(`âš–ï¸ å…©çƒæ•¸å€¼ç›¸åŒï¼Œä¸éœ€è¦äº¤æ›ã€‚`);
  }
}

function resetScale() {
  document.getElementById('scaleBeam').style.transform='translateX(-50%) rotate(0deg)';
  document.getElementById('scaleResult').textContent='â€”';
  renderPan('left',null); renderPan('right',null);
  document.getElementById('swapBtn').disabled=true; document.getElementById('clearBtn').disabled=true;
}

function doSwap() {
  if (!panL||!panR) return;
  const li=panL.index,ri=panR.index,lv=panL.value,rv=panR.value;
  [arr[li],arr[ri]]=[arr[ri],arr[li]];
  swapCount++; updateStats();
  addLog('swap',`äº¤æ› ä½ç½®${li+1}ï¼ˆçƒ ${lv}ï¼‰â†” ä½ç½®${ri+1}ï¼ˆçƒ ${rv}ï¼‰`);
  setMsg(`ğŸ”„ å·²äº¤æ›ï¼çƒ ${lv} ç§»åˆ°ä½ç½®${ri+1}ï¼Œçƒ ${rv} ç§»åˆ°ä½ç½®${li+1}`);
  panL=null; panR=null; resetScale(); renderBalls(); checkWin();
}

function clearPans() { panL=null; panR=null; resetScale(); renderBalls(); setMsg('æ‰˜ç›¤å·²æ¸…é™¤ï¼Œç¹¼çºŒæ‹–æ›³çƒä¾†æ¯”è¼ƒã€‚'); }

function checkWin() {
  if (!isSorted()) return;
  gameDone=true; stopTimer();
  const t=elapsedStr();
  addLog('done',`æ’åºå®Œæˆï¼æ¯”è¼ƒ ${compareCount} æ¬¡ï¼Œäº¤æ› ${swapCount} æ¬¡ï¼Œç”¨æ™‚ ${t}`);
  setMsg(`ğŸ‰ æ’åºå®Œæˆï¼æ¯”è¼ƒ ${compareCount} æ¬¡ï¼Œäº¤æ› ${swapCount} æ¬¡ï¼Œç”¨æ™‚ ${t}`);
  saveHistory(); renderBalls();
  document.getElementById('winStats').innerHTML=`âš–ï¸ æ¯”è¼ƒæ¬¡æ•¸ï¼š${compareCount} æ¬¡<br>ğŸ”„ äº¤æ›æ¬¡æ•¸ï¼š${swapCount} æ¬¡<br>â±ï¸ ç”¨æ™‚ï¼š${t}`;
  document.getElementById('winBanner').style.display='block';
  document.getElementById('winOverlay').style.display='block';
}
function closeWin() { document.getElementById('winBanner').style.display='none'; document.getElementById('winOverlay').style.display='none'; }

function updateStats() { document.getElementById('statCompare').textContent=compareCount; document.getElementById('statSwap').textContent=swapCount; }
function setMsg(text) { document.getElementById('msgBox').innerHTML=text; }

function addLog(type, msg) {
  const list=document.getElementById('logList');
  const entry=document.createElement('div'); entry.className='log-entry';
  const tag=document.createElement('span'); tag.className='tag';
  if (type==='compare'){tag.classList.add('tag-compare');tag.textContent='æ¯”è¼ƒ';}
  else if (type==='swap'){tag.classList.add('tag-swap');tag.textContent='äº¤æ›';}
  else{tag.classList.add('tag-done');tag.textContent='å®Œæˆ';}
  entry.appendChild(tag); entry.appendChild(document.createTextNode(' '+msg));
  list.appendChild(entry); list.scrollTop=list.scrollHeight;
  document.getElementById('logCount').textContent=list.children.length+' ç­†';
}
function clearLog() { document.getElementById('logList').innerHTML=''; document.getElementById('logCount').textContent='0 ç­†'; }

function saveHistory() {
  const n=parseInt(document.getElementById('ballCount').value);
  history.unshift({n,compare:compareCount,swap:swapCount,elapsed:elapsedStr(),time:new Date().toLocaleTimeString('zh-TW')});
  if (history.length>20) history=history.slice(0,20);
  localStorage.setItem('sortHistoryFree',JSON.stringify(history)); renderHistory();
}
function renderHistory() {
  const tbody=document.getElementById('historyBody'); tbody.innerHTML='';
  history.forEach((h,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${h.n} é¡†</td><td>${h.compare}</td><td>${h.swap}</td><td>${h.elapsed||'-'}</td><td>${h.time}</td>`; tbody.appendChild(tr); });
}
function clearHistory() { history=[]; localStorage.removeItem('sortHistoryFree'); renderHistory(); }

renderHistory();
initGame();
</script>
</body>
</html>
